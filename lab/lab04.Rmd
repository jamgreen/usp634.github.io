---
title: "USP 634 Lab 4"
author: "Jamaal Green"
date: "April 19, 2016"
output:
  html_document: default
  pdf_document: default
---

##Completing R Basics and Introduction to Statistical Inference

**Leanring Objectives**
Compute z-scores
Run simulations with R
Compute confidence interval, Margin of Error and Sample Size

Note: we will be using the californiatod dataset we've used the past two labs. If you need, re-download it, if you have it saved, just import it directly into R.

```{r, warning=FALSE, message=FALSE}

#set wd and install "pacman" package. 
#Pacman handles installing and loading packages at once

#setwd("C:/Users/elmue/Desktop/Data1_labs")

#install.packages("pacman", repos='http://cran.us.r-project.org')
library(pacman)

cali <- read.csv("californiatod.csv", header = TRUE)

```

##I. Compute Z-Scores 

We will calculate z-scores using the formula. In order to do so we will use R just as we would use a spreadsheet, creating new variables as we go, and then applying the formula using the new variables we've created along the way.

The z-score for each individual observation of a variable is computed in a similar fashion: the **value for that observation** *minus* a constant (the variable's mean), and then *divided by* **another constant** (the variable's standard deviation).

This is the z-score formula we just described above:

$$z = \frac{x - \bar{x}}{s}$$

For our variable "density", which lists the density for each TOD site, you could create a new variable in R called "z_density" which would contain the z-score for the density variable. We would use this formula:

```{r, warning=FALSE, echo=FALSE}

cali$z_density <- (cali$density - mean(cali$density))/sd(cali$density)
```

Remember that mean(Dataset\$varname) and sd(Dataset\$varname) give you the mean and standard deviation of a variable (varname).

*Calculate z-scores*

You have enough now to calculate z-scores on your own. Calculate z-scores for *houseval* and for *density*, you have yet to do so. 

*Calculate Proportions*

To get the probability of following a certain (e.g. normal) distribution, we use the distribution function with the prefix *p*. For example, for a normal distribution, we use pnorm(x, mean, sd), which give sus the probability up to the value of x. 

\begin{center}
\includegraphics{pnorm.png}
\end{center}

*Calculate the Shaded Area with the pnorm function*

Count the number of rows in the dataset with values in a range:

```
#number of cases with z_score (a variable) values
#between x1 and x2 in Dataset

sum(with(Dataset, z_score > x2 & z_score < x1))

#proportion of cases with a z_score (a variable) #values between x1 and x2 in Dataset

sum(with(Dataset, z_score > x2 & z_score < x1))/nrow(Dataset)
```

##II. Run Simulations with R

Simulate random draws from a population:

> sample(population, size (the number of items to choose), replace = FALSE)

Repeat the simulation with:

> replicate(M, function)

We can combine **sample()** and **replicate()** to simulate the rolling of dice. 

```{r, warning=FALSE, message=FALSE, eval=FALSE}
#Simulate rolling a dice: 
sample(1:6, 1)

#Check the probability of a single roll getting a 4
sample(1:6,1) == 4

#Roll two die and check if we get a 4 and 6

sample(1:6,1) == 4 & sample(1:6, 1) == 4
```

```{r, warning=FALSE, message=FALSE}
#Now we will repeat this 10000 times and
#put it into an object called rep1

rep1 <- replicate(10000, sample(1:6, 1) == 4 & sample(1:6,1) == 6)

#Calculate probability by summing up our
#TRUE responses and then dividing by the 
#number of observations (10000)

sum(rep1, TRUE)/10000
```

##III. Confidence Intervals

1. First, compute the 95% **confidence intervals** for density by hand and looking up the z value from the r table, using R as a calculator. 

```{r, warning=FALSE, message=FALSE}

xbar <- mean(cali$density)
s <- sd(cali$density)
n <- nrow(cali)
alpha <- 1 - 0.95
tstar <- qt(1 - alpha/2, df = n-1)
SE <- s/sqrt(n)
MOE <- tstar*SE
xbar + c(-1,1) * MOE
```

2. You can get the confidence interval when you run a single sample t-test in R (to be covered next week) using the command 

```
t.test(cali$density, alternative='two.sided', mu=0, conf.level=.95)
```

3. Verify whether your calculation is the same as the results from R. 